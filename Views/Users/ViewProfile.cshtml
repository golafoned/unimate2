@model UniMate2.Models.Domain.User

@{
    ViewData["Title"] = $"{Model.FirstName} {Model.LastName}'s Profile";
}

<div class="container my-5">
    <div class="card shadow">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h2 class="mb-0">@Model.FirstName @Model.LastName's Profile</h2>
            <div>
                @if (ViewData["IsFriend"] != null && ViewData["IsFriend"] as bool? == true)
                {
                    <button class="btn btn-light" disabled>
                        <i class="bi bi-person-check-fill"></i> Friends
                    </button>
                }
                else if (ViewData["IsPendingFriend"] != null && ViewData["IsPendingFriend"] as bool? == true)
                {
                    <button class="btn btn-light" disabled>
                        <i class="bi bi-hourglass-split"></i> Request Pending
                    </button>
                }
                else
                {
                    <form asp-controller="Friends" asp-action="SendRequest" method="post" class="d-inline">
                        <input type="hidden" name="ReceiverEmail" value="@Model.Email" />
                        <button type="submit" class="btn btn-light">
                            <i class="bi bi-person-plus"></i> Add Friend
                        </button>
                    </form>
                }
            </div>
        </div>
        <div class="card-body">
            <div class="row">
                <!-- Profile Images -->
                <div class="col-md-4">
                    @if (Model.Images != null && Model.Images.Any())
                    {
                        <div id="profileCarousel" class="carousel slide" data-bs-ride="carousel">
                            <div class="carousel-inner">
                                @for (int i = 0; i < Model.Images.Count; i++)
                                {
                                    <div class="carousel-item @(i == 0 ? "active" : "")">
                                        @if (!string.IsNullOrEmpty(Model.Images[i].ImagePath))
                                        {
                                            <img src="@Model.Images[i].ImagePath" class="d-block w-100 rounded image-clickable" 
                                                alt="Profile Image" style="height: 300px; object-fit: cover;"
                                                data-bs-toggle="modal" data-bs-target="#imageModal" 
                                                data-img-src="@Model.Images[i].ImagePath">
                                        }
                                        else
                                        {
                                            <div class="alert alert-danger">Image path is empty!</div>
                                        }
                                    </div>
                                }
                            </div>
                            @if (Model.Images.Count > 1)
                            {
                                <button class="carousel-control-prev" type="button" data-bs-target="#profileCarousel" data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Previous</span>
                                </button>
                                <button class="carousel-control-next" type="button" data-bs-target="#profileCarousel" data-bs-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Next</span>
                                </button>
                            }
                        </div>
                    }
                    else
                    {
                        <img src="~/images/default-profile.png" class="img-fluid rounded mb-3" alt="Default Profile Image" />
                        <p class="text-muted">No profile images uploaded.</p>
                    }
                </div>
                
                <!-- Profile Details -->
                <div class="col-md-8">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">
                            <strong>Email:</strong> @Model.Email
                        </li>
                        <li class="list-group-item">
                            <strong>Birth Date:</strong> @(Model.BirthDate?.ToString("d") ?? "N/A")
                        </li>
                        <li class="list-group-item">
                            <strong>University:</strong> @(Model.University ?? "N/A")
                        </li>
                        <li class="list-group-item">
                            <strong>Faculty:</strong> @(Model.Faculty ?? "N/A")
                        </li>
                        <li class="list-group-item">
                            <strong>Gender:</strong> @(Model.Gender?.ToString() ?? "N/A")
                        </li>
                        <li class="list-group-item">
                            <strong>Bio:</strong>
                            <p class="mb-0">@(Model.Bio ?? "N/A")</p>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- Modal for full-screen image view -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="imageModalLabel">@(Model?.FirstName ?? "User")'s Photo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <img id="fullSizeImage" src="" class="img-fluid" alt="Full size image">
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Handle clicking on profile images to show in modal
            var imageModal = document.getElementById('imageModal');
            imageModal.addEventListener('show.bs.modal', function(event) {
                var button = event.relatedTarget;
                var imgSrc = button.getAttribute('data-img-src');
                var fullSizeImage = document.getElementById('fullSizeImage');
                fullSizeImage.src = imgSrc;
            });
        });
    </script>
}
